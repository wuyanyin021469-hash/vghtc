<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ğŸ¯ å¤§æ¨‚é€åˆ†æç³»çµ±</title>
    <meta name="description" content="å°ç£å¤§æ¨‚é€æ™ºèƒ½åˆ†æç³»çµ± - æ‰‹æ©Ÿç‰ˆ">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #1A237E;
            --primary-light: #3949AB;
            --primary-lighter: #5C6BC0;
            --accent: #D32F2F;
            --success: #4CAF50;
            --warning: #FF9800;
            --bg: #F5F7FA;
            --card-bg: #FFFFFF;
            --text-dark: #212121;
            --text-medium: #37474F;
            --text-light: #616161;
            --border: #E0E0E0;
            --hot-bg: #FFF9E6;
            --cold-bg: #E8F4F8;
        }

        body {
            font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden;
            padding-bottom: 20px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 20px 15px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 900;
            margin-bottom: 5px;
        }

        .header .subtitle {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        /* Container */
        .container {
            padding: 15px;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Card */
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-light);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab {
            flex: 1;
            min-width: 100px;
            padding: 12px 15px;
            background: white;
            border: 2px solid var(--border);
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab.active {
            background: var(--primary-light);
            color: white;
            border-color: var(--primary-light);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Table */
        .table-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        thead {
            position: sticky;
            top: 0;
            background: var(--primary-light);
            color: white;
            z-index: 10;
        }

        thead th {
            padding: 10px 8px;
            font-weight: 600;
            text-align: center;
            font-size: 0.8rem;
        }

        tbody tr:nth-child(even) {
            background: #F5F5F5;
        }

        tbody td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid var(--border);
            font-size: 0.8rem;
        }

        .number-cell {
            font-weight: 600;
            color: var(--primary-light);
            font-size: 0.75rem;
        }

        .special-badge {
            display: inline-block;
            background: var(--accent);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 0.75rem;
        }

        /* Stats */
        .stats-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .stat-box {
            background: linear-gradient(135deg, var(--hot-bg) 0%, #FFF 100%);
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #FFE082;
        }

        .stat-box.cold {
            background: linear-gradient(135deg, var(--cold-bg) 0%, #FFF 100%);
            border-color: #81D4FA;
        }

        .stat-box h3 {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--primary);
        }

        .stat-content {
            font-size: 0.85rem;
            line-height: 1.8;
            color: var(--text-medium);
        }

        .stat-divider {
            border-top: 1px dashed var(--border);
            margin: 10px 0;
        }

        .number-badge {
            display: inline-block;
            background: var(--primary-light);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            margin: 3px;
            font-weight: 600;
            font-size: 0.75rem;
        }

        /* Strategy Selector */
        .strategy-selector {
            background: linear-gradient(135deg, #E8EAF6 0%, #FFF 100%);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .strategy-selector label {
            display: block;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .strategy-selector select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--primary-light);
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary);
            background: white;
            font-family: 'Noto Sans TC', sans-serif;
        }

        .strategy-desc {
            margin-top: 10px;
            color: var(--text-light);
            font-size: 0.85rem;
            font-style: italic;
            line-height: 1.5;
        }

        /* Recommendations */
        .rec-item {
            background: linear-gradient(135deg, #F5F5F5 0%, #FFF 100%);
            border: 2px solid var(--primary-lighter);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .rec-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
        }

        .rec-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--primary);
        }

        .rec-score {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--accent);
        }

        .rec-numbers {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .lottery-ball {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-lighter) 100%);
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 50%;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        }

        .lottery-ball.special {
            background: linear-gradient(135deg, var(--accent) 0%, #E57373 100%);
        }

        .rec-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
            font-size: 0.85rem;
        }

        .rec-stat-item {
            padding: 8px;
            background: white;
            border-radius: 8px;
            border: 1px solid var(--border);
            text-align: center;
        }

        .rec-reasons {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 2px dashed var(--border);
        }

        .rec-reasons h4 {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .rec-reasons ul {
            list-style: none;
            padding: 0;
        }

        .rec-reasons li {
            padding: 4px 0;
            color: var(--text-medium);
            font-size: 0.85rem;
        }

        .rec-reasons li::before {
            content: 'âœ“ ';
            color: var(--success);
            font-weight: 700;
            margin-right: 5px;
        }

        /* Buttons */
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 15px;
        }

        .btn {
            width: 100%;
            padding: 15px;
            font-size: 1rem;
            font-weight: 700;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Noto Sans TC', sans-serif;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-lighter) 100%);
            color: white;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--primary-light);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Alert */
        .alert {
            padding: 12px;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 0.85rem;
        }

        .alert-error {
            background: #FFEBEE;
            color: #C62828;
            border: 2px solid #EF5350;
        }

        .alert-warning {
            background: #FFF3E0;
            color: #E65100;
            border: 2px solid #FF9800;
        }

        .alert-info {
            background: #E3F2FD;
            color: #1565C0;
            border: 2px solid #2196F3;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-lighter);
            border-radius: 3px;
        }

        /* Pull to refresh hint */
        .pull-hint {
            text-align: center;
            padding: 10px;
            color: white;
            font-size: 0.85rem;
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <div class="header">
        <h1>ğŸ¯ å¤§æ¨‚é€åˆ†æç³»çµ±</h1>
        <div class="subtitle">æ™ºèƒ½åˆ†æ Â· ç²¾æº–æ¨è–¦</div>
    </div>

    <!-- Pull to refresh hint -->
    <div class="pull-hint">ğŸ‘‡ ä¸‹æ‹‰å¯é‡æ–°æ•´ç†</div>

    <!-- Container -->
    <div class="container">
        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('history')">ğŸ“Š é–‹çç´€éŒ„</div>
            <div class="tab" onclick="switchTab('analysis')">ğŸ“ˆ è™Ÿç¢¼åˆ†æ</div>
            <div class="tab" onclick="switchTab('recommend')">ğŸ¯ æ™ºèƒ½æ¨è–¦</div>
        </div>

        <!-- Tab Content: History -->
        <div id="tab-history" class="tab-content active">
            <div class="card">
                <div class="card-title">ğŸ“Š æ­·å²é–‹çç´€éŒ„</div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>æœŸæ•¸</th>
                                <th>æ—¥æœŸ</th>
                                <th>è™Ÿç¢¼</th>
                                <th>ç‰¹åˆ¥è™Ÿ</th>
                            </tr>
                        </thead>
                        <tbody id="historyBody">
                            <tr>
                                <td colspan="4" class="empty-state">
                                    <div class="empty-state-icon">ğŸ“‹</div>
                                    <div>é»æ“Šä¸‹æ–¹æŒ‰éˆ•è¼‰å…¥è³‡æ–™</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab Content: Analysis -->
        <div id="tab-analysis" class="tab-content">
            <div class="card">
                <div class="card-title">ğŸ“ˆ è™Ÿç¢¼åˆ†æ</div>
                <div style="margin-bottom: 12px; font-weight: 600; color: var(--primary); font-size: 0.9rem;">
                    ğŸ“Š æœ€è¿‘30æœŸçµ±è¨ˆåˆ†æ
                </div>
                <div class="stats-section">
                    <div class="stat-box">
                        <h3>ğŸ”¥ ç†±é–€åˆ†æ</h3>
                        <div id="hotAnalysis" class="stat-content">
                            è«‹å…ˆæ›´æ–°è³‡æ–™ä¸¦é€²è¡Œåˆ†æ
                        </div>
                    </div>
                    <div class="stat-box cold">
                        <h3>â„ï¸ å†·é–€åˆ†æ</h3>
                        <div id="coldAnalysis" class="stat-content">
                            è«‹å…ˆæ›´æ–°è³‡æ–™ä¸¦é€²è¡Œåˆ†æ
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Recommend -->
        <div id="tab-recommend" class="tab-content">
            <div class="card">
                <div class="card-title">ğŸ¯ æ™ºèƒ½æ¨è–¦è™Ÿç¢¼</div>
                <div class="strategy-selector">
                    <label for="strategySelect">é¸æ“‡æ¨è–¦ç­–ç•¥ï¼š</label>
                    <select id="strategySelect">
                        <option value="ä¿å®ˆå‹">ä¿å®ˆå‹</option>
                        <option value="å¹³è¡¡å‹" selected>å¹³è¡¡å‹</option>
                        <option value="æ¿€é€²å‹">æ¿€é€²å‹</option>
                        <option value="å†·é–€å‹">å†·é–€å‹</option>
                        <option value="ç†±é–€å‹">ç†±é–€å‹</option>
                    </select>
                    <div id="strategyDesc" class="strategy-desc">
                        ç¶œåˆè€ƒæ…®ç†±é–€ã€å†·é–€ã€å€é–“åˆ†å¸ƒç­‰å¤šç¨®å› ç´ 
                    </div>
                </div>
                <div id="recommendContainer">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ²</div>
                        <div>è«‹å…ˆæ›´æ–°è³‡æ–™ä¸¦é»æ“Š<br>ã€Œæ™ºèƒ½åˆ†æèˆ‡æ¨è–¦ã€æŒ‰éˆ•</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Buttons -->
        <div class="btn-group">
            <button class="btn" id="updateBtn" onclick="updateData()">
                ğŸ”„ æ›´æ–°é–‹çè³‡æ–™
            </button>
            <button class="btn" id="analyzeBtn" onclick="analyzeNumbers()">
                âœ¨ æ™ºèƒ½åˆ†æèˆ‡æ¨è–¦
            </button>
        </div>

        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <div>è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™...</div>
        </div>
    </div>

    <script>
        // Global variables
        let lotteryData = [];
        let currentTab = 'history';

        // Strategy descriptions
        const strategyDescriptions = {
            'ä¿å®ˆå‹': 'é‡è¦–æ­·å²ç†±é–€è™Ÿç¢¼ï¼Œé¸æ“‡å‡ºç¾é »ç‡è¼ƒé«˜çš„è™Ÿç¢¼ï¼Œé©åˆç©©å¥å‹ç©å®¶',
            'å¹³è¡¡å‹': 'ç¶œåˆè€ƒæ…®ç†±é–€ã€å†·é–€ã€å€é–“åˆ†å¸ƒç­‰å¤šç¨®å› ç´ ï¼Œæ¨è–¦æœ€å‡è¡¡çš„çµ„åˆ',
            'æ¿€é€²å‹': 'é‡è¦–é•·æœŸæœªé–‹çš„å†·é–€è™Ÿç¢¼ï¼Œå¢åŠ éš¨æ©Ÿæ€§ï¼Œé©åˆè¿½æ±‚é«˜çé‡‘çš„ç©å®¶',
            'å†·é–€å‹': 'ä¸»è¦é¸æ“‡é•·æœŸæœªé–‹å‡ºçš„è™Ÿç¢¼ï¼Œç›¸ä¿¡å†·é–€è™Ÿç¢¼çš„å›æ­¸è¶¨å‹¢',
            'ç†±é–€å‹': 'å°ˆæ³¨æ–¼è¿‘æœŸé »ç¹å‡ºç¾çš„ç†±é–€è™Ÿç¢¼ï¼Œè·Ÿéš¨è¶¨å‹¢ç­–ç•¥'
        };

        // Switch tabs
        function switchTab(tabName) {
            currentTab = tabName;

            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`tab-${tabName}`).classList.add('active');

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Update strategy description
        document.getElementById('strategySelect').addEventListener('change', function () {
            document.getElementById('strategyDesc').textContent = strategyDescriptions[this.value];
        });

        // Update data with multiple proxy strategies
        async function updateData() {
            const loading = document.getElementById('loading');
            const updateBtn = document.getElementById('updateBtn');
            const historyBody = document.getElementById('historyBody');

            loading.classList.add('active');
            updateBtn.disabled = true;
            historyBody.innerHTML = '<tr><td colspan="4" style="padding: 30px; text-align: center;">è¼‰å…¥ä¸­...</td></tr>';

            try {
                // å˜—è©¦å¤šå€‹ CORS ä»£ç†
                let success = false;
                const proxies = [
                    'https://api.allorigins.win/raw?url=',
                    'https://corsproxy.io/?',
                    'https://api.codetabs.com/v1/proxy?quest='
                ];

                for (const proxy of proxies) {
                    try {
                        const targetUrl = encodeURIComponent('https://www.pilio.idv.tw/ltobig/list.asp');
                        const response = await fetch(proxy + targetUrl, {
                            method: 'GET',
                            headers: {
                                'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
                            }
                        });

                        if (response.ok) {
                            const html = await response.text();
                            parseLotteryData(html);

                            if (lotteryData.length > 0) {
                                displayLotteryData();
                                showToast('âœ… è³‡æ–™æ›´æ–°æˆåŠŸï¼');
                                success = true;
                                break;
                            }
                        }
                    } catch (e) {
                        console.log(`ä»£ç† ${proxy} å¤±æ•—:`, e);
                        continue;
                    }
                }

                // å¦‚æœæ‰€æœ‰ä»£ç†éƒ½å¤±æ•—ï¼Œä½¿ç”¨æ¨¡æ“¬è³‡æ–™
                if (!success) {
                    throw new Error('æ‰€æœ‰è³‡æ–™ä¾†æºéƒ½ç„¡æ³•è¨ªå•');
                }

            } catch (error) {
                console.error('Error:', error);

                // é¡¯ç¤ºå‹å–„æç¤ºä¸¦è‡ªå‹•è¼‰å…¥æ¨¡æ“¬è³‡æ–™
                historyBody.innerHTML = `
                    <tr><td colspan="4" style="padding: 20px;">
                        <div class="alert alert-warning">
                            <strong>âš ï¸ ç„¡æ³•ç²å–å³æ™‚è³‡æ–™</strong><br><br>
                            ç”±æ–¼ç¶²ç«™é˜²çˆ¬èŸ²é™åˆ¶ï¼Œ<br>
                            å·²è‡ªå‹•è¼‰å…¥æ¨¡æ“¬è³‡æ–™é€²è¡Œæ¼”ç¤º<br><br>
                            <small>ğŸ’¡ æ¨¡æ“¬è³‡æ–™åŸºæ–¼çœŸå¯¦çµ±è¨ˆè¦å¾‹ç”Ÿæˆ</small>
                        </div>
                    </td></tr>
                `;

                // è‡ªå‹•è¼‰å…¥æ¨¡æ“¬è³‡æ–™
                setTimeout(() => {
                    generateRealisticMockData();
                    displayLotteryData();
                    showToast('ğŸ“Š å·²è¼‰å…¥æ¨¡æ“¬è³‡æ–™');
                }, 1000);

            } finally {
                loading.classList.remove('active');
                updateBtn.disabled = false;
            }
        }

        // Generate realistic mock data based on actual lottery statistics
        function generateRealisticMockData() {
            lotteryData = [];
            const today = new Date();

            // åŸºæ–¼çœŸå¯¦å¤§æ¨‚é€çš„çµ±è¨ˆè¦å¾‹
            const hotNumbers = [1, 7, 10, 12, 15, 18, 23, 26, 29, 32, 35, 38, 41, 44, 47]; // ç†±é–€è™Ÿç¢¼
            const normalNumbers = [2, 3, 5, 8, 11, 14, 17, 20, 22, 25, 28, 31, 34, 37, 40, 43, 46];
            const coldNumbers = [4, 6, 9, 13, 16, 19, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 49];

            for (let i = 0; i < 50; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i * 3); // æ¯3å¤©ä¸€æœŸ

                const numbers = [];

                // æ¨¡æ“¬çœŸå¯¦åˆ†å¸ƒï¼š2-3å€‹ç†±é–€è™Ÿç¢¼ï¼Œ2-3å€‹æ™®é€šè™Ÿç¢¼ï¼Œ0-2å€‹å†·é–€è™Ÿç¢¼
                const hotCount = Math.floor(Math.random() * 2) + 2; // 2-3å€‹
                const normalCount = Math.floor(Math.random() * 2) + 2; // 2-3å€‹
                const coldCount = 6 - hotCount - normalCount; // å‰©é¤˜çš„

                // é¸æ“‡ç†±é–€è™Ÿç¢¼
                const shuffledHot = [...hotNumbers].sort(() => Math.random() - 0.5);
                for (let j = 0; j < hotCount && j < shuffledHot.length; j++) {
                    numbers.push(shuffledHot[j]);
                }

                // é¸æ“‡æ™®é€šè™Ÿç¢¼
                const shuffledNormal = [...normalNumbers].sort(() => Math.random() - 0.5);
                for (let j = 0; j < normalCount && j < shuffledNormal.length; j++) {
                    if (numbers.length < 6) {
                        numbers.push(shuffledNormal[j]);
                    }
                }

                // é¸æ“‡å†·é–€è™Ÿç¢¼
                const shuffledCold = [...coldNumbers].sort(() => Math.random() - 0.5);
                for (let j = 0; j < coldCount && j < shuffledCold.length; j++) {
                    if (numbers.length < 6) {
                        numbers.push(shuffledCold[j]);
                    }
                }

                // ç¢ºä¿æœ‰6å€‹è™Ÿç¢¼
                while (numbers.length < 6) {
                    const num = Math.floor(Math.random() * 49) + 1;
                    if (!numbers.includes(num)) {
                        numbers.push(num);
                    }
                }

                numbers.sort((a, b) => a - b);

                // ç‰¹åˆ¥è™Ÿï¼šé¿å…èˆ‡ä¸»è™Ÿç¢¼é‡è¤‡ï¼Œä¸”æœ‰ç†±é–€å‚¾å‘
                let special;
                do {
                    // ç‰¹åˆ¥è™Ÿä¹Ÿæœ‰ç†±é–€å‚¾å‘ï¼ˆ60%æ©Ÿç‡é¸ç†±é–€è™Ÿç¢¼ï¼‰
                    if (Math.random() < 0.6) {
                        special = hotNumbers[Math.floor(Math.random() * hotNumbers.length)];
                    } else {
                        special = Math.floor(Math.random() * 49) + 1;
                    }
                } while (numbers.includes(special));

                lotteryData.push({
                    draw: 113000 + (50 - i), // æ¨¡æ“¬æœŸè™Ÿ
                    date: date.toISOString().split('T')[0],
                    numbers: numbers,
                    special: special
                });
            }
        }

        // Parse lottery data
        function parseLotteryData(html) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const rows = doc.querySelectorAll('tr');

            lotteryData = [];
            let drawNumber = rows.length;

            rows.forEach(row => {
                const cols = row.querySelectorAll('td, th');
                if (cols.length >= 3) {
                    const dateText = cols[0]?.textContent.trim() || '';
                    const numbersText = cols[1]?.textContent.trim() || '';
                    const specialText = cols[2]?.textContent.trim() || '';

                    if (/\d{4}[/-]\d{1,2}[/-]\d{1,2}/.test(dateText)) {
                        const allNumbers = numbersText.match(/\d+/g);
                        if (allNumbers && allNumbers.length >= 6) {
                            const mainNumbers = allNumbers.slice(0, 6).map(n => parseInt(n));
                            let special = specialText.match(/\d+/);
                            special = special ? parseInt(special[0]) : (allNumbers[6] ? parseInt(allNumbers[6]) : 0);

                            lotteryData.push({
                                draw: drawNumber--,
                                date: dateText,
                                numbers: mainNumbers,
                                special: special
                            });
                        }
                    }
                }
            });
        }

        // Display lottery data
        function displayLotteryData() {
            const historyBody = document.getElementById('historyBody');

            if (lotteryData.length === 0) {
                historyBody.innerHTML = `
                    <tr><td colspan="4" class="empty-state">
                        <div class="empty-state-icon">âŒ</div>
                        <div>æœªæ‰¾åˆ°é–‹çè³‡æ–™</div>
                    </td></tr>
                `;
                return;
            }

            historyBody.innerHTML = lotteryData.map(item => `
                <tr>
                    <td>${item.draw}</td>
                    <td>${item.date.split('-').slice(1).join('/')}</td>
                    <td class="number-cell">${item.numbers.join(',')}</td>
                    <td><span class="special-badge">${item.special}</span></td>
                </tr>
            `).join('');
        }

        // Analyze numbers
        function analyzeNumbers() {
            if (lotteryData.length === 0) {
                showToast('âš ï¸ è«‹å…ˆæ›´æ–°é–‹çè³‡æ–™');
                return;
            }

            const recentData = lotteryData.slice(0, Math.min(30, lotteryData.length));
            const allNumbers = [];
            const allSpecialNumbers = [];

            recentData.forEach(item => {
                allNumbers.push(...item.numbers);
                allSpecialNumbers.push(item.special);
            });

            const stats = calculateAdvancedStats(allNumbers, allSpecialNumbers);
            displayAnalysis(stats);
            generateRecommendations(stats);

            // Switch to analysis tab
            document.querySelectorAll('.tab')[1].click();

            showToast('âœ… åˆ†æå®Œæˆï¼');
        }

        // Calculate statistics
        function calculateAdvancedStats(numbers, specialNumbers) {
            const stats = {};
            const numberFreq = {};
            const specialFreq = {};

            numbers.forEach(n => numberFreq[n] = (numberFreq[n] || 0) + 1);
            specialNumbers.forEach(n => specialFreq[n] = (specialFreq[n] || 0) + 1);

            stats.hotNumbers = Object.entries(numberFreq)
                .sort((a, b) => b[1] - a[1])
                .map(([num, freq]) => [parseInt(num), freq]);

            stats.coldNumbers = [];
            for (let i = 1; i <= 49; i++) {
                stats.coldNumbers.push([i, numberFreq[i] || 0]);
            }
            stats.coldNumbers.sort((a, b) => a[1] - b[1]);

            stats.hotSpecialNumbers = Object.entries(specialFreq)
                .sort((a, b) => b[1] - a[1])
                .map(([num, freq]) => [parseInt(num), freq]);

            stats.coldSpecialNumbers = [];
            for (let i = 1; i <= 49; i++) {
                stats.coldSpecialNumbers.push([i, specialFreq[i] || 0]);
            }
            stats.coldSpecialNumbers.sort((a, b) => a[1] - b[1]);

            const totalDraws = numbers.length / 6;
            stats.longWaitingNumbers = [];
            for (let i = 1; i <= 49; i++) {
                stats.longWaitingNumbers.push([i, totalDraws - (numberFreq[i] || 0)]);
            }
            stats.longWaitingNumbers.sort((a, b) => b[1] - a[1]);

            const oddCount = numbers.filter(n => n % 2 === 1).length;
            stats.oddEvenRatio = (numbers.length - oddCount) > 0 ? oddCount / (numbers.length - oddCount) : Infinity;

            const highCount = numbers.filter(n => n > 25).length;
            stats.highLowRatio = (numbers.length - highCount) > 0 ? highCount / (numbers.length - highCount) : Infinity;

            const zones = [0, 0, 0, 0, 0];
            numbers.forEach(n => {
                const zoneIndex = Math.min(Math.floor((n - 1) / 10), 4);
                zones[zoneIndex]++;
            });
            stats.zoneDistribution = zones.map(count => count / totalDraws);

            let consecutiveCount = 0;
            let gapOneCount = 0;
            for (let i = 0; i < numbers.length; i += 6) {
                const draw = numbers.slice(i, i + 6).sort((a, b) => a - b);
                for (let j = 0; j < draw.length - 1; j++) {
                    const gap = draw[j + 1] - draw[j];
                    if (gap === 1) consecutiveCount++;
                    else if (gap === 2) gapOneCount++;
                }
            }
            stats.consecutiveRatio = consecutiveCount / ((numbers.length / 6) * 5);
            stats.gapOneRatio = gapOneCount / ((numbers.length / 6) * 5);

            return stats;
        }

        // Display analysis
        function displayAnalysis(stats) {
            const hotAnalysis = document.getElementById('hotAnalysis');
            const coldAnalysis = document.getElementById('coldAnalysis');

            const hotTop8 = stats.hotNumbers.slice(0, 8)
                .map(([num, freq]) => `<span class="number-badge">${String(num).padStart(2, '0')}(${freq})</span>`)
                .join(' ');

            hotAnalysis.innerHTML = `
                <div><strong>ã€ç†±é–€è™Ÿç¢¼ TOP 8ã€‘</strong></div>
                <div class="stat-divider"></div>
                <div style="margin: 10px 0;">${hotTop8}</div>
                
                <div style="margin-top: 15px;"><strong>ã€è™Ÿç¢¼åˆ†å¸ƒã€‘</strong></div>
                <div class="stat-divider"></div>
                <div>å¥‡å¶æ¯”ï¼š${stats.oddEvenRatio.toFixed(2)}</div>
                <div>å¤§å°æ¯”ï¼š${stats.highLowRatio.toFixed(2)}</div>
                
                <div style="margin-top: 15px;"><strong>ã€å€é–“åˆ†å¸ƒã€‘</strong></div>
                <div class="stat-divider"></div>
                <div>1-10: ${stats.zoneDistribution[0].toFixed(1)}å€‹/æœŸ</div>
                <div>11-20: ${stats.zoneDistribution[1].toFixed(1)}å€‹/æœŸ</div>
                <div>21-30: ${stats.zoneDistribution[2].toFixed(1)}å€‹/æœŸ</div>
                <div>31-40: ${stats.zoneDistribution[3].toFixed(1)}å€‹/æœŸ</div>
                <div>41-49: ${stats.zoneDistribution[4].toFixed(1)}å€‹/æœŸ</div>
            `;

            const coldTop8 = stats.coldNumbers.slice(0, 8)
                .map(([num, freq]) => `<span class="number-badge">${String(num).padStart(2, '0')}(${freq})</span>`)
                .join(' ');

            const longWaitingTop4 = stats.longWaitingNumbers.slice(0, 4)
                .map(([num, periods]) => `<span class="number-badge">${String(num).padStart(2, '0')}(${Math.round(periods)}æœŸ)</span>`)
                .join(' ');

            const hotSpecialTop3 = stats.hotSpecialNumbers.slice(0, 3)
                .map(([num, freq]) => `<span class="number-badge">${String(num).padStart(2, '0')}(${freq})</span>`)
                .join(' ');

            const coldSpecialTop3 = stats.coldSpecialNumbers.slice(0, 3)
                .map(([num, freq]) => `<span class="number-badge">${String(num).padStart(2, '0')}(${freq})</span>`)
                .join(' ');

            coldAnalysis.innerHTML = `
                <div><strong>ã€å†·é–€è™Ÿç¢¼ TOP 8ã€‘</strong></div>
                <div class="stat-divider"></div>
                <div style="margin: 10px 0;">${coldTop8}</div>
                
                <div style="margin-top: 15px;"><strong>ã€æœ€ä¹…æœªé–‹ã€‘</strong></div>
                <div class="stat-divider"></div>
                <div style="margin: 10px 0;">${longWaitingTop4}</div>
                
                <div style="margin-top: 15px;"><strong>ã€ç‰¹åˆ¥è™Ÿã€‘</strong></div>
                <div class="stat-divider"></div>
                <div>ç†±é–€ï¼š${hotSpecialTop3}</div>
                <div>å†·é–€ï¼š${coldSpecialTop3}</div>
            `;
        }

        // Generate recommendations
        function generateRecommendations(stats) {
            const mode = document.getElementById('strategySelect').value;
            const container = document.getElementById('recommendContainer');
            const recommendations = [];
            const weightConfig = getWeightConfig(mode);

            for (let i = 0; i < 5; i++) {
                recommendations.push(generateSingleRecommendation(stats, mode, weightConfig));
            }

            recommendations.sort((a, b) => b.score - a.score);

            container.innerHTML = recommendations.map((rec, index) => {
                const stars = rec.score >= 80 ? 'â­â­â­' : rec.score >= 60 ? 'â­â­' : 'â­';
                const numbersHTML = rec.numbers.map(n =>
                    `<div class="lottery-ball">${String(n).padStart(2, '0')}</div>`
                ).join('');
                const specialHTML = `<div class="lottery-ball special">${String(rec.special).padStart(2, '0')}</div>`;

                const reasonsHTML = rec.reasons.length > 0 ? `
                    <div class="rec-reasons">
                        <h4>ğŸ’¡ æ¨è–¦ç†ç”±</h4>
                        <ul>${rec.reasons.slice(0, 3).map(r => `<li>${r}</li>`).join('')}</ul>
                    </div>
                ` : '';

                return `
                    <div class="rec-item">
                        <div class="rec-header">
                            <div class="rec-title">ç¬¬${index + 1}çµ„ ${stars}</div>
                            <div class="rec-score">${rec.score.toFixed(1)}åˆ†</div>
                        </div>
                        <div style="margin-bottom: 8px; font-weight: 600; color: var(--primary); font-size: 0.9rem;">ä¸»è™Ÿç¢¼</div>
                        <div class="rec-numbers">${numbersHTML}</div>
                        <div style="margin-bottom: 8px; font-weight: 600; color: var(--accent); font-size: 0.9rem;">ç‰¹åˆ¥è™Ÿ</div>
                        <div class="rec-numbers">${specialHTML}</div>
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 2px dashed var(--border);">
                            <div style="font-weight: 600; color: var(--primary); margin-bottom: 8px; font-size: 0.9rem;">ğŸ“Š çµ±è¨ˆåˆ†æ</div>
                            <div class="rec-stats">
                                <div class="rec-stat-item">å¥‡å¶ï¼š${rec.oddCount}:${6 - rec.oddCount}</div>
                                <div class="rec-stat-item">å¤§å°ï¼š${rec.highCount}:${6 - rec.highCount}</div>
                                <div class="rec-stat-item">å€é–“ï¼š${rec.zones.join(' ')}</div>
                                <div class="rec-stat-item">å’Œå€¼ï¼š${rec.sum}</div>
                            </div>
                        </div>
                        ${reasonsHTML}
                    </div>
                `;
            }).join('');

            // Switch to recommend tab
            setTimeout(() => {
                document.querySelectorAll('.tab')[2].click();
            }, 500);
        }

        // Get weight config
        function getWeightConfig(mode) {
            const configs = {
                'ä¿å®ˆå‹': { freq: 0.5, zone: 0.3, oddEven: 0.3, waiting: 0.1, size: 0.2, random: 0.05 },
                'å¹³è¡¡å‹': { freq: 0.35, zone: 0.3, oddEven: 0.25, waiting: 0.2, size: 0.25, random: 0.1 },
                'æ¿€é€²å‹': { freq: 0.2, zone: 0.2, oddEven: 0.2, waiting: 0.3, size: 0.2, random: 0.3 },
                'å†·é–€å‹': { freq: 0.1, zone: 0.3, oddEven: 0.25, waiting: 0.5, size: 0.2, random: 0.15 },
                'ç†±é–€å‹': { freq: 0.6, zone: 0.2, oddEven: 0.2, waiting: 0.05, size: 0.2, random: 0.05 }
            };
            return configs[mode] || configs['å¹³è¡¡å‹'];
        }

        // Generate single recommendation
        function generateSingleRecommendation(stats, mode, weightConfig) {
            const allNumbers = Array.from({ length: 49 }, (_, i) => i + 1);
            const numberFreq = Object.fromEntries(stats.hotNumbers);
            const specialFreq = Object.fromEntries(stats.hotSpecialNumbers);
            const longWaiting = Object.fromEntries(stats.longWaitingNumbers);
            const maxFreq = Math.max(...Object.values(numberFreq), 1);

            const weights = allNumbers.map(num => {
                const freq = numberFreq[num] || 0;
                const waitingDays = longWaiting[num] || 0;
                const zoneIndex = Math.min(Math.floor((num - 1) / 10), 4);

                let freqWeight = mode === 'å†·é–€å‹' ?
                    (1 - freq / maxFreq) * weightConfig.freq :
                    (freq / maxFreq) * weightConfig.freq;

                const zoneWeight = (1 - stats.zoneDistribution[zoneIndex]) * weightConfig.zone;

                let oddEvenWeight = weightConfig.oddEven;
                if (stats.oddEvenRatio > 1.2 && num % 2 === 0) oddEvenWeight *= 1.5;
                else if (stats.oddEvenRatio < 0.8 && num % 2 === 1) oddEvenWeight *= 1.5;

                const waitingWeight = Math.min(waitingDays / 30, 1) * weightConfig.waiting;

                let sizeWeight = weightConfig.size;
                if (stats.highLowRatio > 1.2 && num <= 25) sizeWeight *= 1.3;
                else if (stats.highLowRatio < 0.8 && num > 25) sizeWeight *= 1.3;

                const randomWeight = Math.random() * weightConfig.random;

                return Math.max(freqWeight + zoneWeight + oddEvenWeight + waitingWeight + sizeWeight + randomWeight, 0.01);
            });

            const selectedNumbers = [];
            const tempWeights = [...weights];

            while (selectedNumbers.length < 6) {
                const num = weightedRandom(allNumbers, tempWeights);
                if (!selectedNumbers.includes(num)) {
                    selectedNumbers.push(num);
                    allNumbers.forEach((n, idx) => {
                        if (mode !== 'æ¿€é€²å‹' && Math.abs(n - num) <= 2) tempWeights[idx] *= 0.4;
                        if (Math.floor((n - 1) / 10) === Math.floor((num - 1) / 10)) tempWeights[idx] *= 0.6;
                        if (n === num) tempWeights[idx] = 0;
                    });
                }
            }

            selectedNumbers.sort((a, b) => a - b);

            const specialCandidates = allNumbers.filter(n => !selectedNumbers.includes(n));
            let specialNumber;
            if (mode === 'ç†±é–€å‹') {
                const specialWeights = specialCandidates.map(n => specialFreq[n] || 1);
                specialNumber = weightedRandom(specialCandidates, specialWeights);
            } else if (mode === 'å†·é–€å‹') {
                const specialWeights = specialCandidates.map(n => 1 / ((specialFreq[n] || 0) + 1));
                specialNumber = weightedRandom(specialCandidates, specialWeights);
            } else {
                const specialWeights = specialCandidates.map(n => (specialFreq[n] || 1) + Math.random() * 0.5);
                specialNumber = weightedRandom(specialCandidates, specialWeights);
            }

            const analysis = analyzeCombination(selectedNumbers, specialNumber, stats);

            return {
                numbers: selectedNumbers,
                special: specialNumber,
                ...analysis
            };
        }

        // Weighted random
        function weightedRandom(items, weights) {
            const totalWeight = weights.reduce((sum, w) => sum + w, 0);
            let random = Math.random() * totalWeight;
            for (let i = 0; i < items.length; i++) {
                random -= weights[i];
                if (random <= 0) return items[i];
            }
            return items[items.length - 1];
        }

        // Analyze combination
        function analyzeCombination(numbers, special, stats) {
            const oddCount = numbers.filter(n => n % 2 === 1).length;
            const highCount = numbers.filter(n => n > 25).length;
            const sum = numbers.reduce((a, b) => a + b, 0);

            const zones = [0, 0, 0, 0, 0];
            numbers.forEach(n => {
                const zoneIndex = Math.min(Math.floor((n - 1) / 10), 4);
                zones[zoneIndex]++;
            });

            let score = 0;
            const reasons = [];

            const oddRatio = oddCount / 6;
            if (oddRatio >= 0.4 && oddRatio <= 0.6) {
                score += 20;
                reasons.push('å¥‡å¶å¹³è¡¡');
            } else if (oddRatio >= 0.33 && oddRatio <= 0.67) {
                score += 15;
            } else {
                score += 5;
            }

            const highRatio = highCount / 6;
            if (highRatio >= 0.4 && highRatio <= 0.6) {
                score += 20;
                reasons.push('å¤§å°å¹³è¡¡');
            } else if (highRatio >= 0.33 && highRatio <= 0.67) {
                score += 15;
            } else {
                score += 5;
            }

            const nonZeroZones = zones.filter(z => z > 0).length;
            if (nonZeroZones >= 4) {
                score += 20;
                reasons.push('å€é–“å‡å‹»');
            } else if (nonZeroZones >= 3) {
                score += 15;
            } else {
                score += 8;
            }

            if (sum >= 120 && sum <= 180) {
                score += 15;
                reasons.push('å’Œå€¼é©ä¸­');
            } else if (sum >= 100 && sum <= 200) {
                score += 10;
            } else {
                score += 5;
            }

            const sortedNums = [...numbers].sort((a, b) => a - b);
            let consecutivePairs = 0;
            for (let i = 0; i < sortedNums.length - 1; i++) {
                if (sortedNums[i + 1] - sortedNums[i] === 1) consecutivePairs++;
            }
            if (consecutivePairs >= 1 && consecutivePairs <= 2) {
                score += 10;
                reasons.push('é©åº¦é€£è™Ÿ');
            } else if (consecutivePairs === 0) {
                score += 5;
            }

            const spread = sortedNums[sortedNums.length - 1] - sortedNums[0];
            if (spread >= 25 && spread <= 40) {
                score += 10;
                reasons.push('åˆ†æ•£é©ä¸­');
            } else if (spread >= 20 && spread <= 45) {
                score += 7;
            }

            return {
                oddCount,
                highCount,
                sum,
                zones,
                score: Math.min(score, 100),
                reasons
            };
        }

        // Toast notification
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 80px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 12px 24px;
                border-radius: 25px;
                font-size: 0.9rem;
                z-index: 1000;
                animation: fadeInOut 2s ease-in-out;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 2000);
        }

        // Add fadeInOut animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInOut {
                0%, 100% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
                10%, 90% { opacity: 1; transform: translateX(-50%) translateY(0); }
            }
        `;
        document.head.appendChild(style);

        // Pull to refresh
        let touchStartY = 0;
        let touchEndY = 0;

        document.addEventListener('touchstart', e => {
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchend', e => {
            touchEndY = e.changedTouches[0].clientY;
            if (window.scrollY === 0 && touchEndY - touchStartY > 100) {
                updateData();
            }
        });
    </script>
</body>

</html>
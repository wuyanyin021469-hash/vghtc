<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ å°ç£å¤§æ¨‚é€è™Ÿç¢¼åˆ†æç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1A237E 0%, #3949AB 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid #E3F2FD;
        }

        .section-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #1A237E;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3949AB;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            max-height: 500px;
            overflow-y: auto;
            display: block;
        }

        .history-table thead {
            position: sticky;
            top: 0;
            background: #3949AB;
            color: white;
            z-index: 10;
        }

        .history-table th {
            padding: 12px;
            text-align: center;
            font-weight: bold;
        }

        .history-table tbody {
            display: block;
            max-height: 450px;
            overflow-y: auto;
        }

        .history-table tr {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        .history-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #E0E0E0;
        }

        .history-table tbody tr:nth-child(even) {
            background: #F5F5F5;
        }

        .history-table tbody tr:hover {
            background: #E3F2FD;
            transition: background 0.3s;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .stats-box {
            background: linear-gradient(135deg, #FFF9E6 0%, #FFF3CD 100%);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #FFE082;
        }

        .stats-box.cold {
            background: linear-gradient(135deg, #E8F4F8 0%, #B3E5FC 100%);
            border: 2px solid #81D4FA;
        }

        .stats-box h3 {
            color: #1A237E;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .stats-content {
            font-size: 0.95em;
            line-height: 1.8;
            color: #37474F;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-line;
        }

        .recommend-section {
            grid-column: 1 / -1;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid #E3F2FD;
        }

        .mode-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: #F5F7FA;
            border-radius: 10px;
        }

        .mode-selector label {
            font-weight: bold;
            color: #1A237E;
        }

        .mode-selector select {
            padding: 10px 15px;
            border: 2px solid #3949AB;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            cursor: pointer;
            background: white;
            transition: all 0.3s;
        }

        .mode-selector select:hover {
            border-color: #5C6BC0;
            box-shadow: 0 2px 8px rgba(57, 73, 171, 0.2);
        }

        .strategy-desc {
            color: #616161;
            font-size: 0.9em;
            flex: 1;
        }

        .recommend-results {
            background: white;
            border: 1px solid #E0E0E0;
            border-radius: 10px;
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Consolas', 'Courier New', monospace;
            white-space: pre-line;
            line-height: 1.6;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 20px;
            background: #F5F7FA;
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3949AB 0%, #5C6BC0 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(57, 73, 171, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #00897B 0%, #26A69A 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 137, 123, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }

        .number-ball {
            display: inline-block;
            width: 35px;
            height: 35px;
            line-height: 35px;
            text-align: center;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
            color: white;
            font-weight: bold;
            margin: 2px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .special-ball {
            background: linear-gradient(135deg, #4CAF50 0%, #66BB6A 100%);
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ å°ç£å¤§æ¨‚é€è™Ÿç¢¼åˆ†æç³»çµ±</h1>
            <p>æ™ºèƒ½åˆ†æ Â· ç²¾æº–æ¨è–¦ Â· æ•¸æ“šé©…å‹•</p>
        </div>

        <div class="main-content">
            <div class="section">
                <div class="section-title">ğŸ“Š æ­·å²é–‹çç´€éŒ„</div>
                <table class="history-table">
                    <thead>
                        <tr>
                            <th style="width: 15%">æœŸæ•¸</th>
                            <th style="width: 25%">é–‹çæ—¥æœŸ</th>
                            <th style="width: 45%">ä¸­çè™Ÿç¢¼</th>
                            <th style="width: 15%">ç‰¹åˆ¥è™Ÿ</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody">
                        <tr>
                            <td colspan="4" class="loading">é»æ“Šã€Œæ›´æ–°é–‹çè³‡æ–™ã€è¼‰å…¥æ•¸æ“š...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="section">
                <div class="section-title">ğŸ“ˆ è™Ÿç¢¼åˆ†æ</div>
                <div class="analysis-grid">
                    <div class="stats-box">
                        <h3>ğŸ”¥ ç†±é–€åˆ†æ</h3>
                        <div class="stats-content" id="hotStats">é»æ“Šã€Œæ™ºèƒ½åˆ†æèˆ‡æ¨è–¦ã€é–‹å§‹åˆ†æ...</div>
                    </div>
                    <div class="stats-box cold">
                        <h3>â„ï¸ å†·é–€åˆ†æ</h3>
                        <div class="stats-content" id="coldStats">é»æ“Šã€Œæ™ºèƒ½åˆ†æèˆ‡æ¨è–¦ã€é–‹å§‹åˆ†æ...</div>
                    </div>
                </div>
            </div>

            <div class="recommend-section">
                <div class="section-title">ğŸ¯ æ™ºèƒ½æ¨è–¦è™Ÿç¢¼</div>
                <div class="mode-selector">
                    <label>æ¨è–¦ç­–ç•¥ï¼š</label>
                    <select id="recommendMode">
                        <option value="ä¿å®ˆå‹">ä¿å®ˆå‹</option>
                        <option value="å¹³è¡¡å‹" selected>å¹³è¡¡å‹</option>
                        <option value="æ¿€é€²å‹">æ¿€é€²å‹</option>
                        <option value="å†·é–€å‹">å†·é–€å‹</option>
                        <option value="ç†±é–€å‹">ç†±é–€å‹</option>
                    </select>
                    <span class="strategy-desc" id="strategyDesc">ç¶œåˆè€ƒæ…®ç†±é–€ã€å†·é–€ã€å€é–“åˆ†å¸ƒç­‰å¤šç¨®å› ç´ </span>
                </div>
                <div class="recommend-results" id="recommendResults">
                    é¸æ“‡æ¨è–¦ç­–ç•¥å¾Œï¼Œé»æ“Šã€Œæ™ºèƒ½åˆ†æèˆ‡æ¨è–¦ã€ç”Ÿæˆæ¨è–¦è™Ÿç¢¼...
                </div>
            </div>
        </div>

        <div class="button-group">
            <button class="btn btn-primary" onclick="updateData()">ğŸ”„ æ›´æ–°é–‹çè³‡æ–™</button>
            <button class="btn btn-secondary" onclick="analyzeNumbers()">âœ¨ æ™ºèƒ½åˆ†æèˆ‡æ¨è–¦</button>
        </div>
    </div>

    <script>
        let lotteryData = [];

        // ç­–ç•¥èªªæ˜
        const strategyDescriptions = {
            "ä¿å®ˆå‹": "é‡è¦–æ­·å²ç†±é–€è™Ÿç¢¼ï¼Œé¸æ“‡å‡ºç¾é »ç‡è¼ƒé«˜çš„è™Ÿç¢¼",
            "å¹³è¡¡å‹": "ç¶œåˆè€ƒæ…®ç†±é–€ã€å†·é–€ã€å€é–“åˆ†å¸ƒç­‰å¤šç¨®å› ç´ ",
            "æ¿€é€²å‹": "é‡è¦–é•·æœŸæœªé–‹çš„å†·é–€è™Ÿç¢¼ï¼Œå¢åŠ éš¨æ©Ÿæ€§",
            "å†·é–€å‹": "ä¸»è¦é¸æ“‡é•·æœŸæœªé–‹å‡ºçš„è™Ÿç¢¼ï¼Œç›¸ä¿¡å›æ­¸è¶¨å‹¢",
            "ç†±é–€å‹": "å°ˆæ³¨æ–¼è¿‘æœŸé »ç¹å‡ºç¾çš„ç†±é–€è™Ÿç¢¼ï¼Œè·Ÿéš¨è¶¨å‹¢"
        };

        // æ›´æ–°ç­–ç•¥èªªæ˜
        document.getElementById('recommendMode').addEventListener('change', function() {
            const mode = this.value;
            document.getElementById('strategyDesc').textContent = strategyDescriptions[mode];
        });

        // æ›´æ–°é–‹çè³‡æ–™
        async function updateData() {
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = '<tr><td colspan="4" class="loading">æ­£åœ¨è¼‰å…¥æ•¸æ“šï¼Œè«‹ç¨å€™...</td></tr>';

            try {
                // ä½¿ç”¨ CORS ä»£ç†ä¾†ç²å–æ•¸æ“š
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                const targetUrl = encodeURIComponent('https://www.pilio.idv.tw/ltobig/list.asp');
                
                const response = await fetch(proxyUrl + targetUrl);
                const text = await response.text();
                
                // è§£æ HTML
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');
                
                // æŸ¥æ‰¾æ‰€æœ‰è¡¨æ ¼è¡Œ
                const rows = doc.querySelectorAll('tr');
                lotteryData = [];
                let drawNumber = 1;
                
                rows.forEach(row => {
                    const cols = row.querySelectorAll('td, th');
                    if (cols.length >= 3) {
                        const dateText = cols[0].textContent.trim();
                        const numbersText = cols[1].textContent.trim();
                        const specialText = cols[2] ? cols[2].textContent.trim() : '';
                        
                        // æª¢æŸ¥æ˜¯å¦ç‚ºæœ‰æ•ˆçš„æ—¥æœŸæ ¼å¼
                        if (/\d{4}[-/]\d{1,2}[-/]\d{1,2}/.test(dateText)) {
                            // æå–æ‰€æœ‰æ•¸å­—
                            const allNumbers = numbersText.match(/\d+/g);
                            if (allNumbers && allNumbers.length >= 6) {
                                const mainNumbers = allNumbers.slice(0, 6);
                                let special = specialText.match(/\d+/);
                                if (!special && allNumbers.length >= 7) {
                                    special = allNumbers[6];
                                } else if (special) {
                                    special = special[0];
                                }
                                
                                lotteryData.push({
                                    draw: drawNumber++,
                                    date: dateText,
                                    numbers: mainNumbers.map(n => parseInt(n)),
                                    special: special ? parseInt(special) : 0
                                });
                            }
                        }
                    }
                });
                
                // å¦‚æœæ²’æœ‰æ•¸æ“šï¼Œä½¿ç”¨æ¨¡æ“¬æ•¸æ“š
                if (lotteryData.length === 0) {
                    alert('ç„¡æ³•å¾ç¶²ç«™ç²å–æ•¸æ“šï¼Œä½¿ç”¨æ¨¡æ“¬æ•¸æ“šé€²è¡Œæ¼”ç¤º...');
                    generateMockData();
                }
                
                displayHistoryData();
                
            } catch (error) {
                console.error('Error:', error);
                alert('ç„¡æ³•é€£æ¥åˆ°æ•¸æ“šæºï¼Œä½¿ç”¨æ¨¡æ“¬æ•¸æ“šé€²è¡Œæ¼”ç¤º...');
                generateMockData();
                displayHistoryData();
            }
        }

        // ç”Ÿæˆæ¨¡æ“¬æ•¸æ“š
        function generateMockData() {
            lotteryData = [];
            const today = new Date();
            
            for (let i = 0; i < 50; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i * 3);
                
                const numbers = [];
                while (numbers.length < 6) {
                    const num = Math.floor(Math.random() * 49) + 1;
                    if (!numbers.includes(num)) {
                        numbers.push(num);
                    }
                }
                numbers.sort((a, b) => a - b);
                
                let special;
                do {
                    special = Math.floor(Math.random() * 49) + 1;
                } while (numbers.includes(special));
                
                lotteryData.push({
                    draw: 50 - i,
                    date: date.toISOString().split('T')[0],
                    numbers: numbers,
                    special: special
                });
            }
        }

        // é¡¯ç¤ºæ­·å²æ•¸æ“š
        function displayHistoryData() {
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = '';
            
            lotteryData.forEach((data, index) => {
                const row = tbody.insertRow();
                row.insertCell(0).textContent = data.draw;
                row.insertCell(1).textContent = data.date;
                row.insertCell(2).textContent = data.numbers.join(', ');
                row.insertCell(3).textContent = data.special;
            });
        }

        // åˆ†æè™Ÿç¢¼
        function analyzeNumbers() {
            if (lotteryData.length === 0) {
                alert('è«‹å…ˆæ›´æ–°é–‹çè³‡æ–™ï¼');
                return;
            }

            // æ”¶é›†æœ€è¿‘30æœŸæ•¸æ“š
            const recentData = lotteryData.slice(0, Math.min(30, lotteryData.length));
            const allNumbers = [];
            const allSpecials = [];
            
            recentData.forEach(data => {
                allNumbers.push(...data.numbers);
                allSpecials.push(data.special);
            });

            // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
            const stats = calculateAdvancedStats(allNumbers, allSpecials);
            
            // é¡¯ç¤ºç†±é–€åˆ†æ
            displayHotStats(stats);
            
            // é¡¯ç¤ºå†·é–€åˆ†æ
            displayColdStats(stats);
            
            // ç”Ÿæˆæ¨è–¦è™Ÿç¢¼
            const mode = document.getElementById('recommendMode').value;
            generateRecommendations(stats, mode);
        }

        // è¨ˆç®—é€²éšçµ±è¨ˆ
        function calculateAdvancedStats(numbers, specials) {
            const stats = {};
            
            // è™Ÿç¢¼é »ç‡
            const numberFreq = {};
            const specialFreq = {};
            
            for (let i = 1; i <= 49; i++) {
                numberFreq[i] = 0;
                specialFreq[i] = 0;
            }
            
            numbers.forEach(n => numberFreq[n]++);
            specials.forEach(n => specialFreq[n]++);
            
            // ç†±é–€å’Œå†·é–€è™Ÿç¢¼
            stats.hotNumbers = Object.entries(numberFreq)
                .sort((a, b) => b[1] - a[1]);
            stats.coldNumbers = Object.entries(numberFreq)
                .sort((a, b) => a[1] - b[1]);
            
            // ç‰¹åˆ¥è™Ÿçµ±è¨ˆ
            stats.hotSpecials = Object.entries(specialFreq)
                .sort((a, b) => b[1] - a[1]);
            stats.coldSpecials = Object.entries(specialFreq)
                .sort((a, b) => a[1] - b[1]);
            
            // é•·æœŸæœªé–‹è™Ÿç¢¼
            const totalDraws = numbers.length / 6;
            stats.longWaiting = Object.entries(numberFreq)
                .map(([num, freq]) => [num, totalDraws - freq])
                .sort((a, b) => b[1] - a[1]);
            
            // å¥‡å¶æ¯”
            const oddCount = numbers.filter(n => n % 2 === 1).length;
            const evenCount = numbers.length - oddCount;
            stats.oddEvenRatio = evenCount > 0 ? oddCount / evenCount : 0;
            
            // å¤§å°æ¯”
            const highCount = numbers.filter(n => n > 25).length;
            const lowCount = numbers.length - highCount;
            stats.highLowRatio = lowCount > 0 ? highCount / lowCount : 0;
            
            // å€é–“åˆ†å¸ƒ
            const zones = [0, 0, 0, 0, 0];
            numbers.forEach(n => {
                const zoneIndex = Math.min(Math.floor((n - 1) / 10), 4);
                zones[zoneIndex]++;
            });
            stats.zoneDistribution = zones.map(z => z / totalDraws);
            
            // é€£è™Ÿåˆ†æ
            let consecutiveCount = 0;
            let gapOneCount = 0;
            
            for (let i = 0; i < numbers.length; i += 6) {
                const draw = numbers.slice(i, i + 6).sort((a, b) => a - b);
                for (let j = 0; j < draw.length - 1; j++) {
                    const gap = draw[j + 1] - draw[j];
                    if (gap === 1) consecutiveCount++;
                    else if (gap === 2) gapOneCount++;
                }
            }
            
            const totalPairs = totalDraws * 5;
            stats.consecutiveRatio = consecutiveCount / totalPairs;
            stats.gapOneRatio = gapOneCount / totalPairs;
            
            return stats;
        }

        // é¡¯ç¤ºç†±é–€çµ±è¨ˆ
        function displayHotStats(stats) {
            const hotStats = document.getElementById('hotStats');
            const top8 = stats.hotNumbers.slice(0, 8);
            
            let html = `ã€ç†±é–€è™Ÿç¢¼ TOP 8ã€‘\n`;
            html += `${'â”€'.repeat(30)}\n`;
            html += top8.map(([num, freq]) => `${num.padStart(2, '0')}(${freq}æ¬¡)`).join(', ') + '\n\n';
            
            html += `ã€è™Ÿç¢¼åˆ†å¸ƒçµ±è¨ˆã€‘\n`;
            html += `${'â”€'.repeat(30)}\n`;
            html += `å¥‡å¶æ¯”ï¼š${stats.oddEvenRatio.toFixed(2)} (å»ºè­°: 0.8-1.2)\n`;
            html += `å¤§å°æ¯”ï¼š${stats.highLowRatio.toFixed(2)} (å»ºè­°: 0.8-1.2)\n\n`;
            
            html += `ã€å€é–“åˆ†å¸ƒã€‘\n`;
            html += `${'â”€'.repeat(30)}\n`;
            html += `1-10:   ${stats.zoneDistribution[0].toFixed(1)}å€‹/æœŸ\n`;
            html += `11-20:  ${stats.zoneDistribution[1].toFixed(1)}å€‹/æœŸ\n`;
            html += `21-30:  ${stats.zoneDistribution[2].toFixed(1)}å€‹/æœŸ\n`;
            html += `31-40:  ${stats.zoneDistribution[3].toFixed(1)}å€‹/æœŸ\n`;
            html += `41-49:  ${stats.zoneDistribution[4].toFixed(1)}å€‹/æœŸ\n\n`;
            
            html += `ã€é€£è™Ÿåˆ†æã€‘\n`;
            html += `${'â”€'.repeat(30)}\n`;
            html += `é€£è™Ÿç‡ï¼š${(stats.consecutiveRatio * 100).toFixed(1)}%\n`;
            html += `é–“éš”ç‡ï¼š${(stats.gapOneRatio * 100).toFixed(1)}%`;
            
            hotStats.textContent = html;
        }

        // é¡¯ç¤ºå†·é–€çµ±è¨ˆ
        function displayColdStats(stats) {
            const coldStats = document.getElementById('coldStats');
            const top8Cold = stats.coldNumbers.slice(0, 8);
            const top4Waiting = stats.longWaiting.slice(0, 4);
            
            let html = `ã€å†·é–€è™Ÿç¢¼ TOP 8ã€‘\n`;
            html += `${'â”€'.repeat(30)}\n`;
            html += top8Cold.map(([num, freq]) => `${num.padStart(2, '0')}(${freq}æ¬¡)`).join(', ') + '\n\n';
            
            html += `ã€æœ€ä¹…æœªé–‹è™Ÿç¢¼ã€‘\n`;
            html += `${'â”€'.repeat(30)}\n`;
            html += top4Waiting.map(([num, days]) => `${num.padStart(2, '0')}(${Math.floor(days)}æœŸ)`).join(', ') + '\n\n';
            
            html += `ã€ç‰¹åˆ¥è™Ÿåˆ†æã€‘\n`;
            html += `${'â”€'.repeat(30)}\n`;
            html += `ç†±é–€ï¼š${stats.hotSpecials.slice(0, 3).map(([num, freq]) => `${num.padStart(2, '0')}(${freq}æ¬¡)`).join(', ')}\n`;
            html += `å†·é–€ï¼š${stats.coldSpecials.slice(0, 3).map(([num, freq]) => `${num.padStart(2, '0')}(${freq}æ¬¡)`).join(', ')}`;
            
            coldStats.textContent = html;
        }

        // ç”Ÿæˆæ¨è–¦è™Ÿç¢¼
        function generateRecommendations(stats, mode) {
            const recommendations = [];
            
            for (let i = 0; i < 5; i++) {
                const selected = selectNumbers(stats, mode);
                const special = selectSpecialNumber(stats, mode, selected);
                const analysis = analyzeCombination(selected, special, stats);
                
                recommendations.push({
                    numbers: selected,
                    special: special,
                    analysis: analysis,
                    score: analysis.score
                });
            }
            
            // æŒ‰è©•åˆ†æ’åº
            recommendations.sort((a, b) => b.score - a.score);
            
            // é¡¯ç¤ºæ¨è–¦çµæœ
            displayRecommendations(recommendations, mode);
        }

        // é¸æ“‡è™Ÿç¢¼
        function selectNumbers(stats, mode) {
            const weights = getWeightConfig(mode);
            const selected = [];
            const numberFreq = Object.fromEntries(stats.hotNumbers);
            const longWaiting = Object.fromEntries(stats.longWaiting);
            const maxFreq = Math.max(...Object.values(numberFreq));
            
            let attempts = 0;
            while (selected.length < 6 && attempts < 100) {
                attempts++;
                const num = weightedRandomSelect(stats, weights, selected, numberFreq, longWaiting, maxFreq, mode);
                
                if (!selected.includes(num) && isValidCombination(selected, num, stats)) {
                    selected.push(num);
                }
            }
            
            // å¦‚æœé¸ä¸æ»¿ï¼Œéš¨æ©Ÿè£œå……
            while (selected.length < 6) {
                const num = Math.floor(Math.random() * 49) + 1;
                if (!selected.includes(num)) {
                    selected.push(num);
                }
            }
            
            return selected.sort((a, b) => a - b);
        }

        // åŠ æ¬Šéš¨æ©Ÿé¸æ“‡
        function weightedRandomSelect(stats, weights, selected, numberFreq, longWaiting, maxFreq, mode) {
            const allWeights = [];
            
            for (let num = 1; num <= 49; num++) {
                if (selected.includes(num)) {
                    allWeights.push(0);
                    continue;
                }
                
                const freq = numberFreq[num] || 0;
                const waiting = longWaiting[num] || 0;
                const zoneIndex = Math.min(Math.floor((num - 1) / 10), 4);
                
                let freqWeight = mode === 'å†·é–€å‹' ? 
                    (1 - freq / maxFreq) * weights.freq : 
                    (freq / maxFreq) * weights.freq;
                
                const zoneWeight = (1 - stats.zoneDistribution[zoneIndex]) * weights.zone;
                
                let oddEvenWeight = weights.oddEven;
                if (stats.oddEvenRatio > 1.2 && num % 2 === 0) oddEvenWeight *= 1.5;
                else if (stats.oddEvenRatio < 0.8 && num % 2 === 1) oddEvenWeight *= 1.5;
                
                const waitingWeight = Math.min(waiting / 30, 1) * weights.waiting;
                
                let sizeWeight = weights.size;
                if (stats.highLowRatio > 1.2 && num <= 25) sizeWeight *= 1.3;
                else if (stats.highLowRatio < 0.8 && num > 25) sizeWeight *= 1.3;
                
                const randomWeight = Math.random() * weights.random;
                
                const totalWeight = Math.max(freqWeight + zoneWeight + oddEvenWeight + waitingWeight + sizeWeight + randomWeight, 0.01);
                allWeights.push(totalWeight);
            }
            
            // åŠ æ¬Šéš¨æ©Ÿé¸æ“‡
            const totalWeight = allWeights.reduce((a, b) => a + b, 0);
            let random = Math.random() * totalWeight;
            
            for (let i = 0; i < allWeights.length; i++) {
                random -= allWeights[i];
                if (random <= 0) {
                    return i + 1;
                }
            }
            
            return Math.floor(Math.random() * 49) + 1;
        }

        // ç²å–æ¬Šé‡é…ç½®
        function getWeightConfig(mode) {
            const configs = {
                "ä¿å®ˆå‹": { freq: 0.5, zone: 0.3, oddEven: 0.3, waiting: 0.1, size: 0.2, random: 0.05 },
                "å¹³è¡¡å‹": { freq: 0.35, zone: 0.3, oddEven: 0.25, waiting: 0.2, size: 0.25, random: 0.1 },
                "æ¿€é€²å‹": { freq: 0.2, zone: 0.2, oddEven: 0.2, waiting: 0.3, size: 0.2, random: 0.3 },
                "å†·é–€å‹": { freq: 0.1, zone: 0.3, oddEven: 0.25, waiting: 0.5, size: 0.2, random: 0.15 },
                "ç†±é–€å‹": { freq: 0.6, zone: 0.2, oddEven: 0.2, waiting: 0.05, size: 0.2, random: 0.05 }
            };
            return configs[mode] || configs["å¹³è¡¡å‹"];
        }

        // æª¢æŸ¥çµ„åˆæ˜¯å¦æœ‰æ•ˆ
        function isValidCombination(selected, newNum, stats) {
            if (selected.length === 0) return true;
            
            const tooCloseCount = selected.filter(n => Math.abs(n - newNum) <= 1).length;
            if (tooCloseCount > 2) return false;
            
            const tempCombination = [...selected, newNum];
            const zones = [0, 0, 0, 0, 0];
            tempCombination.forEach(n => {
                const zoneIndex = Math.min(Math.floor((n - 1) / 10), 4);
                zones[zoneIndex]++;
            });
            
            const nonZeroZones = zones.filter(z => z > 0).length;
            if (nonZeroZones < 2 && tempCombination.length >= 4) return false;
            
            return true;
        }

        // é¸æ“‡ç‰¹åˆ¥è™Ÿ
        function selectSpecialNumber(stats, mode, selectedNumbers) {
            const specialFreq = Object.fromEntries(stats.hotSpecials);
            const candidates = [];
            
            for (let i = 1; i <= 49; i++) {
                if (!selectedNumbers.includes(i)) {
                    candidates.push(i);
                }
            }
            
            if (candidates.length === 0) {
                return Math.floor(Math.random() * 49) + 1;
            }
            
            if (mode === 'ç†±é–€å‹') {
                const weights = candidates.map(n => specialFreq[n] || 1);
                return weightedRandom(candidates, weights);
            } else if (mode === 'å†·é–€å‹') {
                const weights = candidates.map(n => 1 / ((specialFreq[n] || 0) + 1));
                return weightedRandom(candidates, weights);
            } else {
                return candidates[Math.floor(Math.random() * candidates.length)];
            }
        }

        // åŠ æ¬Šéš¨æ©Ÿ
        function weightedRandom(items, weights) {
            const totalWeight = weights.reduce((a, b) => a + b, 0);
            let random = Math.random() * totalWeight;
            
            for (let i = 0; i < items.length; i++) {
                random -= weights[i];
                if (random <= 0) {
                    return items[i];
                }
            }
            
            return items[0];
        }

        // åˆ†æçµ„åˆ
        function analyzeCombination(numbers, special, stats) {
            const analysis = {};
            
            analysis.oddCount = numbers.filter(n => n % 2 === 1).length;
            analysis.highCount = numbers.filter(n => n > 25).length;
            analysis.sum = numbers.reduce((a, b) => a + b, 0);
            
            const zones = [0, 0, 0, 0, 0];
            numbers.forEach(n => {
                const zoneIndex = Math.min(Math.floor((n - 1) / 10), 4);
                zones[zoneIndex]++;
            });
            analysis.zones = zones;
            
            // è¨ˆç®—è©•åˆ†
            let score = 0;
            const reasons = [];
            
            // å¥‡å¶å¹³è¡¡
            const oddRatio = analysis.oddCount / 6;
            if (oddRatio >= 0.4 && oddRatio <= 0.6) {
                score += 20;
                reasons.push('å¥‡å¶å¹³è¡¡');
            } else if (oddRatio >= 0.33 && oddRatio <= 0.67) {
                score += 15;
            } else {
                score += 5;
            }
            
            // å¤§å°å¹³è¡¡
            const highRatio = analysis.highCount / 6;
            if (highRatio >= 0.4 && highRatio <= 0.6) {
                score += 20;
                reasons.push('å¤§å°å¹³è¡¡');
            } else if (highRatio >= 0.33 && highRatio <= 0.67) {
                score += 15;
            } else {
                score += 5;
            }
            
            // å€é–“åˆ†å¸ƒ
            const nonZeroZones = zones.filter(z => z > 0).length;
            if (nonZeroZones >= 4) {
                score += 20;
                reasons.push('å€é–“åˆ†å¸ƒå‡å‹»');
            } else if (nonZeroZones >= 3) {
                score += 15;
            } else {
                score += 8;
            }
            
            // å’Œå€¼
            if (analysis.sum >= 120 && analysis.sum <= 180) {
                score += 15;
                reasons.push('å’Œå€¼é©ä¸­');
            } else if (analysis.sum >= 100 && analysis.sum <= 200) {
                score += 10;
            } else {
                score += 5;
            }
            
            // é€£è™Ÿ
            const sorted = [...numbers].sort((a, b) => a - b);
            let consecutivePairs = 0;
            for (let i = 0; i < sorted.length - 1; i++) {
                if (sorted[i + 1] - sorted[i] === 1) consecutivePairs++;
            }
            if (consecutivePairs >= 1 && consecutivePairs <= 2) {
                score += 10;
                reasons.push('é©åº¦é€£è™Ÿ');
            } else if (consecutivePairs === 0) {
                score += 5;
            }
            
            // åˆ†æ•£åº¦
            const spread = sorted[sorted.length - 1] - sorted[0];
            if (spread >= 25 && spread <= 40) {
                score += 10;
                reasons.push('è™Ÿç¢¼åˆ†æ•£é©ä¸­');
            } else if (spread >= 20 && spread <= 45) {
                score += 7;
            }
            
            analysis.score = Math.min(score, 100);
            analysis.reasons = reasons;
            
            return analysis;
        }

        // é¡¯ç¤ºæ¨è–¦çµæœ
        function displayRecommendations(recommendations, mode) {
            const resultsDiv = document.getElementById('recommendResults');
            
            let html = `â•”${'â•'.repeat(58)}â•—\n`;
            html += `â•‘${' '.repeat(15)}${mode}æ¨è–¦ç­–ç•¥${' '.repeat(15)}â•‘\n`;
            html += `â•š${'â•'.repeat(58)}â•\n\n`;
            
            recommendations.forEach((rec, i) => {
                const numbersStr = rec.numbers.map(n => n.toString().padStart(2, '0')).join('  ');
                const analysis = rec.analysis;
                const score = rec.score;
                
                let scoreMark = score >= 80 ? 'â­â­â­' : (score >= 60 ? 'â­â­' : 'â­');
                
                html += `â”Œ${'â”€'.repeat(58)}â”\n`;
                html += `â”‚ ã€ç¬¬${i + 1}çµ„æ¨è–¦ã€‘${scoreMark} è©•åˆ†ï¼š${score.toFixed(1)}/100\n`;
                html += `â”œ${'â”€'.repeat(58)}â”¤\n`;
                html += `â”‚ ä¸»è™Ÿç¢¼ï¼š${numbersStr}\n`;
                html += `â”‚ ç‰¹åˆ¥è™Ÿï¼š${rec.special.toString().padStart(2, '0')}\n`;
                html += `â”œ${'â”€'.repeat(58)}â”¤\n`;
                html += `â”‚ ğŸ“Š çµ±è¨ˆåˆ†æï¼š\n`;
                html += `â”‚   â€¢ å¥‡å¶æ¯”ï¼š${analysis.oddCount}å¥‡ ${6 - analysis.oddCount}å¶\n`;
                html += `â”‚   â€¢ å¤§å°æ¯”ï¼š${analysis.highCount}å¤§ ${6 - analysis.highCount}å°\n`;
                html += `â”‚   â€¢ å€é–“åˆ†å¸ƒï¼š${analysis.zones.join(' ')}\n`;
                html += `â”‚   â€¢ å’Œå€¼ï¼š${analysis.sum}\n`;
                
                if (analysis.reasons.length > 0) {
                    html += `â”‚\nâ”‚ ğŸ’¡ æ¨è–¦ç†ç”±ï¼š\n`;
                    analysis.reasons.slice(0, 3).forEach(reason => {
                        html += `â”‚   âœ“ ${reason}\n`;
                    });
                }
                
                html += `â””${'â”€'.repeat(58)}â”˜\n\n`;
            });
            
            html += `â•”${'â•'.repeat(58)}â•—\n`;
            html += `â•‘${' '.repeat(18)}ç­–ç•¥èªªæ˜${' '.repeat(18)}â•‘\n`;
            html += `â•š${'â•'.repeat(58)}â•\n`;
            html += `  ${strategyDescriptions[mode]}\n`;
            
            resultsDiv.textContent = html;
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.addEventListener('load', function() {
            console.log('å°ç£å¤§æ¨‚é€è™Ÿç¢¼åˆ†æç³»çµ±å·²è¼‰å…¥');
        });
    </script>
</body>
</html>
